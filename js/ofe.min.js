window.onload=function(){ofeApp.init()};var ofeApp={init:function(){this.numberKey=parseInt(6e5*Math.random()+1e5),this.keysArray=[],this.fileSize=0,this.fileName="",this.inputFile=null,this.tb_keyNumber=document.getElementById("keyNumber"),this.tb_keyNumber.value=this.numberKey.toString(),this.lb_inputFile=document.getElementById("lb_inputFile"),this.el_inputFile=document.getElementById("inputFile"),this.el_inputFile.addEventListener("change",this.createInputFile.bind(this),!1),this.bt_encode=document.getElementById("bt_encode"),this.bt_encode.addEventListener("click",this.setEncodeMode.bind(this),!1),this.bt_encode=document.getElementById("bt_decode"),this.bt_encode.addEventListener("click",this.setDecodeMode.bind(this),!1)},createInputFile:function(e){var t=e.target.files,i=new FileReader,n=this;i.onload=function(){n.inputFile=new Uint8Array(this.result),n.fileSize=n.el_inputFile.files[0].size,n.fileName=n.el_inputFile.files[0].name,n.lb_inputFile.innerHTML=n.fileName},i.readAsArrayBuffer(t[0])},setEncodeMode:function(){var e=this.validation();""==e?(this.keysArray=this.tb_keyNumber.value.split(""),this.processFile("encrypt")):alert(e)},setDecodeMode:function(){var e=this.validation();""==e?(this.keysArray=this.tb_keyNumber.value.split(""),this.processFile("decrypt")):alert(e)},processFile:function(e){var t=this,i=0,n=0,r=0,s=0,a=1;switch(e){case"encrypt":for(var l=new Uint8Array(2*this.fileSize),o=t.fileSize,d=0;d<o;d++)i=t.inputFile[d],n=t.getVariation(a),r=i+n,r>255&&(r=parseInt(r%255)),255==i&&(l[2*d+1]=1),0==i&&(r=0),l[2*d]=r,a++,a>12&&(a=1);t.saveOutputFile("encrypted_"+t.fileName,l);break;case"decrypt":for(var l=new Uint8Array(this.fileSize/2),o=t.fileSize,d=0;d<o;d+=2)1==t.inputFile[d+1]?s=255:(r=t.inputFile[d],n=t.getVariation(a),n<255&&n>r?s=255+r-n:n<255&&n<r&&(s=r-n),0==r&&(s=0)),l[d/2]=s,a++,a>12&&(a=1);t.saveOutputFile("decrypted_"+t.fileName,l)}},getVariation:function(e){var t=parseInt(this.keysArray[0]*e+this.keysArray[1]*(e+1)+this.keysArray[2]*(e+2)+this.keysArray[3]*Math.sqrt(e)-this.keysArray[4]+Math.sqrt(this.keysArray[5])+15*e);return t>220&&(t=parseInt(t%220)),t},saveOutputFile:function(e,t){var i=new Blob([t],{type:"application/octet-stream"}),n=document.createElement("a");n.download=e,n.href=(window.webkitURL||window.URL).createObjectURL(i),n.dataset.downloadurl=["application/octet-stream",n.download,n.href].join(":"),n.click()},validation:function(){var e=/^[0-9]{6}$/;return null==this.inputFile?"Choose a file to process":e.test(this.tb_keyNumber.value)?"":"The key must be a 6-digit number (ex: 154852)"}};